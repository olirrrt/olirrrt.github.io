<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Tag: å›¾å½¢å­¦ - .</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="."><meta name="msapplication-TileImage" content="images/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="."><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="."><meta property="og:url" content="https://olirrrt.github.io/"><meta property="og:site_name" content="."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://olirrrt.github.io/img/og_image.png"><meta property="article:author" content="shugen"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://olirrrt.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://olirrrt.github.io"},"headline":".","image":["https://olirrrt.github.io/img/og_image.png"],"author":{"@type":"Person","name":"shugen"},"publisher":{"@type":"Organization","name":".","logo":{"@type":"ImageObject"}},"description":null}</script><link rel="icon" href="/images/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">.</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">å›¾å½¢å­¦</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2023-02-04T16:00:00.000Z" title="2/5/2023, 12:00:00â€¯AM">2023-02-05</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2023-02-05T13:00:13.436Z" title="2/5/2023, 9:00:13â€¯PM">2023-02-05</time></span><span class="level-item">19 minutes lesen (Ãœber 2809 WÃ¶rter)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/05/Games202-2/">Games202-2 å®æ—¶ç¯å¢ƒå…‰ç…§</a></h1><div class="content"><h2 id="1-IBL"><a href="#1-IBL" class="headerlink" title="1.IBL"></a>1.IBL</h2><h3 id="1-0"><a href="#1-0" class="headerlink" title="1.0"></a>1.0</h3><p>å…ˆç®€å•ç›˜ä¸€ä¸‹æ•°å­¦ï¼š</p>
<p><strong>æ¦‚ç‡å¯†åº¦å‡½æ•°</strong>ï¼šå…¶ç§¯åˆ†å€¼&#x3D;å®šä¹‰åŸŸå†…çš„æ¦‚ç‡å€¼ï¼Œ$\int_{-\infin}^{+\infin}f(x)dx&#x3D;1$</p>
<p><strong>æœŸæœ›</strong>ï¼šæ¯æ¬¡å¯èƒ½çš„ç»“æœä¹˜ä»¥å…¶ç»“æœæ¦‚ç‡çš„æ€»å’Œï¼Œæè¿°äº†éšæœºå˜é‡çš„å¹³å‡å€¼</p>
<p><strong>æ–¹å·®</strong>ï¼šéšæœºå˜é‡ç¦»æœŸæœ›çš„è·ç¦»ï¼Œæè¿°äº†éšæœºå˜é‡çš„ç¦»æ•£ç¨‹åº¦</p>
<p><strong>å¤§æ•°å®šå¾‹</strong>ï¼šå½“æ ·æœ¬æ•°é‡è¶³å¤Ÿå¤§æ—¶ï¼Œäº‹ä»¶å‘ç”Ÿçš„<strong>é¢‘ç‡</strong>æ”¶æ•›äº<strong>æ¦‚ç‡</strong>ã€‚å¦‚ï¼šä¸ºäº†è®¡ç®—ä¸€ä¸ªå›½å®¶æ‰€æœ‰å…¬æ°‘çš„å¹³å‡èº«é«˜ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ª<strong>å®Œå…¨éšæœº</strong>ï¼ˆ<strong>æ— å</strong>ï¼‰çš„äººå£å­é›†ï¼Œæµ‹é‡ä»–ä»¬çš„èº«é«˜å¹¶å¯¹ç»“æœæ±‚å¹³å‡ï¼Œå³<strong>ç”¨å‡å€¼è¿‘ä¼¼æ±‚è§£æ¦‚ç‡</strong>ã€‚</p>
<p><strong>è’™ç‰¹å¡ç½—ç§¯åˆ†</strong>ï¼š$\int_{a}^{b}f(x)dx\approx \frac{1}{N}\sum_{i&#x3D;0}^{N-1}\frac{f(x)}{pdf(x)}$</p>
<p>pdfå€¼æ›´é«˜çš„æ ·æœ¬è¢«é€‰å–çš„å¯èƒ½æ€§æ›´å¤§ï¼Œå³æŸäº›æ ·æœ¬å¯èƒ½æ¯”å…¶ä»–æ ·æœ¬å…·æœ‰æ›´é«˜çš„ç”Ÿæˆæ¦‚ç‡ï¼Œæ‰€ä»¥è¦é™¤ä»¥<strong>æˆ–</strong>ä¹˜ä»¥pdfä»¥å¹³è¡¡ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª<strong>æƒé‡</strong>ã€‚å¦‚ï¼šåœ¨<strong>å•ä½çƒä½“</strong>è¡¨é¢$\Omega$ç”ŸæˆNä¸ªéšæœºé‡‡æ ·ï¼Œæƒè¡¡æ¯ä¸ªæ ·æœ¬å¯¹ç»“æœçš„è´¡çŒ®å¹¶æ±‚å’Œã€‚ç”±çƒä½“è¡¨é¢ç§¯å…¬å¼ï¼Œè¿™ç§æƒ…å†µä¸‹ã€æ¯ä¸ªæ ·æœ¬å¯èƒ½æ€§$p(x_i)&#x3D;\frac{1}{4\pi}$ï¼Œå› æ­¤æƒé‡$\omega_i&#x3D;\frac{1}{p(x_i)}&#x3D;4\pi$ã€‚</p>
<p><strong>ä½å·®å¼‚åºåˆ—</strong>ï¼šéšæœºæ ·æœ¬ï¼Œä½†æ ·æœ¬åˆ†å¸ƒæ›´å‡åŒ€</p>
<p><strong>åˆ†å±‚é‡‡æ ·</strong>ï¼šä¸ºäº†é™ä½æ ·æœ¬çš„<strong>æ–¹å·®</strong>ï¼Œåˆ’åˆ†å•å…ƒï¼Œæ¯ä¸ªå•å…ƒå†…ç”Ÿæˆä¸€ä¸ªéšæœºæ ·æœ¬</p>
<p><strong>é‡è¦æ€§é‡‡æ ·</strong>ï¼šå·²çŸ¥pdfå‡½æ•°çš„åˆ†å¸ƒä¿¡æ¯ç”Ÿæˆé‡‡æ ·å‘é‡ã€‚</p>
<h3 id="1-1-Diffuse"><a href="#1-1-Diffuse" class="headerlink" title="1.1 Diffuse"></a>1.1 Diffuse</h3><p>â€‹		æˆ‘ä»¬çŸ¥é“å¤©ç©ºç›’å¯ä»¥æ¨¡æ‹Ÿ<strong>é¥è¿œçš„</strong>ç¯å¢ƒå…‰ï¼Œåœ¨æ—©æœŸçš„å®è·µä¸­ï¼Œäººä»¬ä¼šç”¨åå°„æˆ–æŠ˜å°„å‘é‡é‡‡æ ·å¤©ç©ºç›’çº¹ç†ä½œä¸ºç‰©ä½“è¡¨é¢é¢œè‰²ï¼Œä»¥æ¨¡æ‹Ÿç¯å¢ƒå…‰æºå¯¹ç€è‰²çš„å½±å“ï¼Œè¿™ä¸€æŠ€æœ¯è¢«ç§°ä¸ºç¯å¢ƒè´´å›¾ã€‚è€Œéšç€æ¸²æŸ“æ¨¡å‹çš„å‡çº§ï¼Œç®€å•ç¯å¢ƒè´´å›¾æ˜¾ç„¶ä¸èƒ½æ»¡è¶³éœ€è¦ï¼ŒåŸºäºå›¾åƒçš„å…‰ç…§ï¼ˆimage based lightingï¼‰åº”è¿è€Œç”Ÿã€‚</p>
<p>â€‹		æ¸²æŸ“æ–¹ç¨‹ï¼ˆä¸è€ƒè™‘é˜´å½±ï¼‰ï¼š<br>$$<br>L_o(p, \omega_o)&#x3D;\int_{\Omega}(k_d\frac{c}{\pi}+k_s\frac{DFG}{4(\omega_oÂ·n)(\omega_iÂ·n)})L_i(p,\omega_i)nÂ·\omega_id\omega_i<br>$$<br>â€‹		å¯ä»¥æ‹†åˆ†ä¸ºæ¼«åå°„å’Œé•œé¢ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­æ¼«åå°„éƒ¨åˆ†ä¸ºï¼š<br>$$<br>L_o(p, \omega_o)&#x3D;k_d\frac{c}{\pi}\int_{\Omega}L_i(p,\omega_i)nÂ·\omega_id\omega_i<br>$$</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/ibl_hemisphere_sample.png" alt="ibl_hemisphere_sample" style="zoom:50%;" /></center>

<p>â€‹		Lambertçš„æ¼«åå°„é¡¹æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå› æ­¤éœ€è¦å¯¹æ¥è‡ªå››é¢å…«æ–¹çš„ç¯å¢ƒå…‰è®¡ç®—å‡å€¼ï¼Œå¹¶ç”¨é¡¶ç‚¹æ³•çº¿æŸ¥è¯¢ã€‚å¯¹äºæ¯ä¸€ä¸ªå¯èƒ½çš„é‡‡æ ·æ–¹å‘nï¼Œsåœ¨åŠçƒè¡¨é¢å‡åŒ€ç”Ÿæˆæ ·æœ¬æ±‚å¹³å‡ã€‚éå†é‡‡æ ·æ–¹å‘ï¼Œå¯ä»¥éå†$\theta$, $\phi$ï¼Œå¹¶è½¬æ¢æˆæ–¹å‘å‘é‡ï¼š<br>$$<br>\begin{cases} x&#x3D;rsin\theta cos\phi<br>\ y&#x3D;rsin\theta cos\phi<br>\ z&#x3D;rcos\phi<br>\end{cases}<br>$$<br>â€‹		ä¹Ÿå¯ä»¥ç›´æ¥æ¸²æŸ“ä¸€ä¸ªä½äºåŸç‚¹çš„å•ä½ç«‹æ–¹ä½“ï¼Œç”¨å½’ä¸€åŒ–åçš„æœ¬åœ°åæ ‡é‡‡æ ·ã€‚</p>
<p>â€‹		å…³äºæ ·æœ¬çš„ç”Ÿæˆï¼Œå¯ä»¥ç”¨è’™ç‰¹å¡æ´›ç§¯åˆ†æ³•ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯é»æ›¼å’Œæ³•ã€‚å…¬å¼2çš„<strong>ç¦»æ•£</strong>ç‰ˆæœ¬ï¼š<br>$$<br>L_o(p,\phi,\theta)&#x3D;K_d\frac{c}{\pi}\frac{1}{n_1n_2}\sum_{\phi&#x3D;0}^{n_1}\sum_{\theta&#x3D;0}^{n_2}L_i(p,\phi_i,\theta_i)cos(\theta)sin(\theta)d\theta d\phi<br>$$<br>â€‹		å…¶ä¸­ï¼Œç«‹ä½“è§’å…¬å¼ï¼š$\Omega&#x3D;\frac{dA}{r^2}&#x3D;sin(\theta)d\theta d\phi$ï¼Œ$sin(\theta)$ä¹Ÿå¯ä»¥ç†è§£æˆæ˜¯ç”¨æ¥å¹³è¡¡çƒä½“ä¸¤æä½ç½®çš„é‡‡æ ·åŒºåŸŸï¼ˆpatches )è¾ƒå°è€Œèµ¤é“å¤„è¾ƒå¤§çš„å½¢çŠ¶ã€‚</p>
<p>â€‹		å› ä¸ºå–å¹³å‡çš„æ–¹æ³•ä¸¢å¤±äº†å…‰ç…§çš„å¤§éƒ¨åˆ†é«˜é¢‘ç»†èŠ‚ï¼Œå› æ­¤çº¹ç†åˆ†è¾¨ç‡æ— éœ€å¤ªé«˜ã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/ibl_irradiance-5522165.png" alt="ibl_irradiance" style="zoom:75%;" /></center>



<h3 id="1-2-Specular"><a href="#1-2-Specular" class="headerlink" title="1.2 Specular"></a>1.2 Specular</h3><p>â€‹		åˆ†å‰²æ±‚å’Œè¿‘ä¼¼æ³•ï¼ˆsplit sum approximationï¼‰å°†é•œé¢åå°„ç§¯åˆ†æ‹†æˆä¸¤ä¸ªç‹¬ç«‹çš„ç§¯åˆ†ï¼š<br>$$<br>L_o(p, \omega_o)&#x3D;\int_{\Omega}L_i(p,\omega_i)d\omega_i * \int_{\Omega}k_sf_r(\omega_o,\omega_i)nÂ·\omega_id _{\omega_i}<br>$$</p>
<h4 id="1-2-1-é¢„æ»¤æ³¢è´´å›¾"><a href="#1-2-1-é¢„æ»¤æ³¢è´´å›¾" class="headerlink" title="1.2.1 é¢„æ»¤æ³¢è´´å›¾"></a>1.2.1 é¢„æ»¤æ³¢è´´å›¾</h4><p>â€‹		ç§¯åˆ†çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œç±»ä¼¼æ¼«åå°„è¾ç…§åº¦è´´å›¾ï¼Œä½†éœ€è¦å°†ç²—ç³™åº¦çº³å…¥è€ƒè™‘èŒƒå›´ã€‚ä¸åŒäºlambertå¹³é¢çš„å‡åŒ€åå°„ï¼Œglossyç‰©ä½“è¡¨é¢çš„é•œé¢åå°„å…‰çš„å½¢çŠ¶å–å†³äºè¡¨é¢çš„ç²—ç³™ã€‚æ‰€æœ‰å¯èƒ½çš„åå°„å…‰çº¿ä¼šå½¢æˆä¸€ä¸ªspecular lobeï¼Œå›´ç»•ç€åå°„å‘é‡Rï¼Œè¡¨é¢è¶Šç²—ç³™ï¼Œåå°„è¶Šåˆ†æ•£ã€‚å› æ­¤å‡åŒ€é‡‡æ ·ä¼šå¯¼è‡´æ— æ•ˆé‡‡æ ·ã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/ibl_specular_lobe.png" style="zoom: 100%;" /></center>

<p>â€‹		GGXé‡è¦æ€§é‡‡æ ·ä¼šæ ¹æ®ç²—ç³™åº¦ï¼Œå°†å¾®è¡¨é¢çš„åŠç¨‹å‘é‡åå‘å…¶å®è§‚åå°„æ–¹å‘ï¼Œå³å‘ç€åå°„å‘é‡â€œèšé›†â€ï¼Œä½¿å…¶åˆ†å¸ƒé™åˆ¶åœ¨lobeå†…ã€‚æ ¹æ®lobeçš„<strong>å½¢çŠ¶</strong>å†³å®šæ ·æœ¬è¦†ç›–çš„<strong>èŒƒå›´</strong>ï¼Œåœ¨å®æ—¶ç«¯ç”¨é•œé¢åå°„RæŸ¥è¯¢ï¼š</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-05 00.03.57.png" alt="2023-02-05 00.03.57" style="zoom:40%;" /></center>

<p>â€‹		ç†è®ºä¸Šæ¥è¯´ç²—ç³™åº¦è¶Šé«˜ï¼Œåå°„è¶Šæ¨¡ç³Šã€‚å¯ä»¥åœ¨0åˆ°1é—´å–å‡ ä¸ªé”šç‚¹ï¼Œç”Ÿæˆå¯¹åº”çš„è´´å›¾ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ç”Ÿæˆæ•°ä¸ªçº§åˆ«çš„mipmapï¼Œå¹¶ç”¨ç²—ç³™åº¦çº¿æ€§æ’å€¼ã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-04 22.38.02.png" alt="2023-02-04 22.38.02" style="zoom:44%;" /></center>



<h4 id="1-2-2-BRDFç§¯åˆ†è´´å›¾"><a href="#1-2-2-BRDFç§¯åˆ†è´´å›¾" class="headerlink" title="1.2.2 BRDFç§¯åˆ†è´´å›¾"></a>1.2.2 BRDFç§¯åˆ†è´´å›¾</h4><p>â€‹		å¯¹äºç¬¬äºŒéƒ¨åˆ†brdfå…¬å¼ï¼Œæœ‰3ä¸ªå˜é‡$\omega_iã€w_o$ã€ç²—ç³™åº¦å’ŒåŸºç¡€åå°„ç‡$F_0$ï¼Œä¸ºäº†å‡å°‘å˜é‡æ•°ï¼Œéœ€è¦å¯¹æ–¹ç¨‹è¿›è¡Œä¸€äº›å˜å½¢ã€‚</p>
<p>â€‹		brdfä¸­çš„è²æ¶…å°”é¡¹å…¬å¼ä¸ºï¼š<br>$$<br>F(h,\omega_o)&#x3D;F_0+(1-F_0)(1-cos\theta)^5<br>\ \quad\quad\quad\quad\quad\quad\quad\quad &#x3D;F_0(1-(1-cos\theta)^5)+ (1-cos\theta)^5<br>$$</p>
<p>â€‹		ç¬¬äºŒéƒ¨åˆ†åˆ†å­åˆ†æ¯åŒä¹˜è²æ¶…å°”é¡¹ï¼š<br>$$<br>L_o(p, \omega_o)&#x3D;\int_{\Omega}\frac{f_r(\omega_o,\omega_i,r)}{F(h,\omega_0)}F(h,\omega_0)nÂ·\omega_id _{\omega_i}<br>$$</p>
<p>â€‹		ä»£å…¥å…¬å¼6ï¼Œå¹¶å°†ç§¯åˆ†æ‹†æˆä¸¤é¡¹ï¼š<br>$$<br>F_0\int_{\Omega} \frac{f_r(\omega_o,\omega_i,r)}{F(h,\omega_0)}(1-(1-cos\theta)^5)nÂ·\omega_id_{\omega_i} +<br>\int_{\Omega} \frac{f_r(\omega_o,\omega_i,r)}{F(h,\omega_0)}(1-cos\theta)^5nÂ·\omega_id_{\omega_i}<br>$$</p>
<p>â€‹		å…¶ä¸­$fr$çš„åˆ†æ¯åŒ…å«Fé¡¹ï¼Œçº¦åˆ†åæœ‰ï¼š<br>$$<br>F_0\int_{\Omega}f_r(\omega_o,\omega_i,r)(1-(1-cos\theta)^5)nÂ·\omega_id_{\omega_i}+\int_{\Omega}f_r(\omega_o,\omega_i,r)(1-cos\theta)^5nÂ·\omega_id_{\omega_i}<br>$$<br>â€‹		$F_0$è¢«æå–åˆ°ç§¯åˆ†ä¹‹å¤–ï¼Œæ‰€ä»¥æœ€ç»ˆåªéœ€è¦è®¡ç®—2ä¸ªå˜é‡$(roughness,\theta)$çš„å¯èƒ½æ€§ç»„åˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥$co s\theta$ä¸ºæ¨ªåæ ‡ï¼Œç²—ç³™åº¦ä¸ºçºµåæ ‡ï¼ŒRã€Gé€šé“å„å­˜æ”¾ä¸€ä¸ªé¢„è®¡ç®—å€¼ï¼Œå¾—åˆ°è¿™æ ·ä¸€å¼ æŸ¥æ‰¾è¡¨ï¼š</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-04 20.59.39.png" alt="2023-02-04 20.59.24" style="zoom:75%;" /></center>

<p>â€‹		ä»¥ä¸Šæ˜¯å»ºç«‹åœ¨ç¯å¢ƒå…‰æºæ— é™è¿œçš„å‡è®¾ä¸Šï¼Œåœºæ™¯ä¸­çš„å„ä¸ªç‚¹æ‰€æ¥æ”¶åˆ°çš„è¾ç…§åº¦æ˜¯ç›¸åŒçš„ï¼Œå³æ— è§†render point ä½ç½®ï¼Œä½†åœ¨å®¤å†…è¿™æ ·ç¯å¢ƒå…‰åˆ†å¸ƒå·®å¼‚è¾ƒå¤§çš„åœºæ™¯å°±ä¼šæ˜¾å¾—ä¸çœŸå®ï¼Œå¼•æ“ä¸­é€šå¸¸åœ¨åœºæ™¯ä¸­æ”¾ç½®å¤šä¸ªåå°„æ¢é’ˆï¼Œå®æ—¶è®¡ç®—æ—¶æ’å€¼ã€‚</p>
<h2 id="2-Spherical-Harmonic"><a href="#2-Spherical-Harmonic" class="headerlink" title="2. Spherical Harmonic"></a>2. Spherical Harmonic</h2><p><strong>åŸºå‡½æ•°</strong>ï¼šä¸€ç»„ç®€å•ä¿¡å·ï¼Œå¯ä»¥é€šè¿‡çº¿æ€§å˜æ¢ï¼ˆç¼©æ”¾ã€ç›¸åŠ ï¼‰ç”ŸæˆåŸå‡½æ•°çš„<strong>è¿‘ä¼¼</strong>ã€‚</p>
<p><strong>æŠ•å½±</strong>ï¼šè®¡ç®—å‡ºæ¯ä¸€ä¸ªåŸºå‡½æ•°<strong>æƒé‡å€¼</strong>çš„è¿‡ç¨‹ã€‚è¿™ä¸€æ ‡é‡æè¿°äº†åŸå‡½æ•°$f(x)$<strong>æœ‰å¤šæ¥è¿‘</strong>æ¯ä¸€ä¸ªåŸºå‡½æ•°$B_i(x)$ã€‚è®¡ç®—æ¯ä¸€ä¸ªæƒé‡çš„è¿‡ç¨‹ï¼Œå°±æ˜¯åœ¨fçš„å®šä¹‰åŸŸä¸Šè®¡ç®—$f(x)B_i(x)$çš„ç§¯åˆ†ï¼š<br>$$<br>c_i&#x3D;\int_{\Omega}f(\omega)B_i(\omega)d\omega<br>$$<br><strong>é‡å»º</strong>ï¼šç±»ä¼¼å·ç§¯çš„è¿‡ç¨‹ï¼Œç”¨æ¯ä¸€ä¸ªåŸºå‡½æ•°ä¹˜ä»¥å…¶å¯¹åº”æƒé‡ã€å¹¶ç´¯åŠ çš„ç»“æœå»<strong>è¿‘ä¼¼</strong>åŸå‡½æ•°ã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/Screenshot%202023-02-02%20114949.png" style="zoom:80%;" /><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/Screenshot%202023-02-02%20114712.png" style="zoom:85%;" /><p  style="color:#A9A9A9;">
    æŠ•å½±å’Œé‡å»ºçš„è¿‡ç¨‹</p>  </center>

<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/Screenshot%202023-02-02%20114739-1675310084563-6.png"  /> <p  style="color:#A9A9A9;">è™šçº¿ï¼šåŸå‡½æ•°ï¼›å®çº¿ï¼šè¿‘ä¼¼å‡½æ•°</p>  </center>

<p><strong>çƒè°å‡½æ•°</strong>ï¼šå¯ä»¥è§†ä½œä¸‰ç»´ç©ºé—´å¯¹äºŒç»´å¹³é¢fourierå˜æ¢çš„<strong>ç±»æ¯”</strong>ï¼š</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/Screenshot%202023-02-02%20115734.png" style="zoom: 75%;" /> <p  style="color:#A9A9A9;">ä½¿ç”¨çƒè°å‡½æ•°çš„è¿‘ä¼¼ï¼Œå¯ä»¥çœ‹åˆ°é˜¶æ•°è¶Šé«˜è¶Šæ¥è¿‘åŸå‡½æ•°</p>  </center>

<p>â€‹		åŸºå‡½æ•°æ•°é‡å†³å®šè¿˜åŸçš„ç²¾ç¡®åº¦ï¼Œä½é˜¶é€šå¸¸ä¼šæŸå¤±é«˜é¢‘ä¿¡æ¯ã€‚å¼•æ“ä¸­å¸¸ç”¨çš„æ˜¯9é˜¶ï¼ˆl &#x3D; 9ï¼‰çƒè°å‡½æ•°ï¼Œå·¥ä½œæ–¹æ³•ç±»ä¼¼ä¸€ä¸ªä½é€šæ»¤æ³¢å™¨ï¼ˆåªé€šè¿‡ä½é¢‘ä¿¡æ¯ï¼‰ï¼Œç¬¦åˆç¯å¢ƒ-æ¼«åå°„è¾ç…§åº¦çš„ç‰¹ç‚¹ï¼›æ­¤å¤–ï¼Œé‡å»ºçš„è¿‡ç¨‹å°†ç§¯åˆ†é™ä¸ºç‚¹ä¹˜ï¼Œåœ¨ç°ä»£GPUæ¶æ„ä¸Šæå¤§åœ°æé«˜äº†æ•ˆç‡ã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-01-20%2017.55.30.png" style="zoom:50%;" /><div><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-01-20%2017.55.32.png"  /></div><p style="color:#A9A9A9;">
    ä½¬ã®é„™å¤·
    </p></center>


<h2 id="3-PRT"><a href="#3-PRT" class="headerlink" title="3.PRT"></a>3.PRT</h2><p>â€‹		å¦‚æœéœ€è¦å°†é˜´å½±å’Œbrdfé¡¹ä¹Ÿçº³å…¥è€ƒè™‘èŒƒå›´ï¼Œéœ€è¦åœ¨æ¯ç‚¹åˆ†å¸ƒç”Ÿæˆ3å¼ è´´å›¾ï¼Œæ‰€éœ€å†…å­˜è¿‡å¤šã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/Screenshot%202023-02-02%20111917.png" style="zoom:67%;" /></center>

<p>â€‹		precomputed radiance transferåˆ™å¯ä»¥çœ‹ä½œæ˜¯ä¸Šè¿°æ–¹æ¡ˆçš„ä¸€ä¸ªå¹³æ›¿ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯å°†æ¸²æŸ“æ–¹ç¨‹æ‹†æˆå…‰ç…§å’Œä¼ è¾“ä¸¤é¡¹ï¼Œåˆ†åˆ«æŠ•å½±åˆ°çƒè°å‡½æ•°ä¸Šï¼Œå¹¶åœ¨å®æ—¶ç«¯é‡å»ºå…‰ç…§ã€‚å…¶å‰æå’Œé™åˆ¶æ˜¯ï¼Œå‡è®¾åœºæ™¯ä¸­çš„ç‰©ä½“å’Œè§†è§’éƒ½ä¿æŒä¸å˜ï¼Œåªæœ‰å…‰æºå˜åŒ–ï¼ˆå¯æ—‹è½¬ï¼Œæ—‹è½¬å…‰æºç›¸å½“äºæ—‹è½¬ä»»æ„ä¸€ä¸ªåŸºå‡½æ•°ï¼‰ã€‚</p>
<h3 id="3-1-Diffuse"><a href="#3-1-Diffuse" class="headerlink" title="3.1 Diffuse"></a>3.1 Diffuse</h3><p>â€‹		å…‰ç…§æ–¹ç¨‹ï¼š<br>$$<br>L(o) &#x3D; \int_{\Omega}\textcolor{}{L(i)}\textcolor{}{V(i)\rho(i,o) max(0, nÂ·i)}d_i<br>$$<br>â€‹		ç”±å‰æ–‡ï¼Œå…‰ç…§å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š<br>$$<br>L(i)\approx \sum l_iB_i(i)<br>$$<br>â€‹		ä»£å…¥åŸå¼ã€å¹¶äº¤æ¢ç§¯åˆ†æ±‚å’Œé¡ºåºï¼Œæœ‰ï¼š<br>$$<br>L(o) \approx \sum l_i \int_{\Omega}\textcolor{Crimson}{B_i(i)}\textcolor{Teal}{V(i)\rho(i,o) max(0, nÂ·i)}d_i<br>$$<br>â€‹		å¯ä»¥çœ‹åˆ°ç§¯åˆ†çš„å³åŠéƒ¨åˆ†ä¹Ÿå¯ä»¥è§†ä½œæ˜¯åŸºå‡½æ•° * ä¸€ä¸ªè¢«æŠ•å½±å‡½æ•°çš„<strong>å½¢å¼</strong>ï¼Œè¿™ä¸€å‡½æ•°å³ä¼ è¾“å‡½æ•°$T(i)$ï¼Œæ‰€ä»¥æœ‰æ±‚ä¼ è¾“é¡¹ç³»æ•°çš„æ–¹æ³•ä¸ºï¼š<br>$$<br>T_i\approx \int_{\Omega}B_i(i)V(i)max(0,n	Â·i)di<br>$$</p>
<p>â€‹		åœ¨å®æ—¶ç«¯ï¼Œå°†ä¸¤ä¸ªç³»æ•°ç›¸ä¹˜å¹¶ç´¯åŠ ï¼Œè¿‘ä¼¼åŸå…‰ç…§ï¼Œä»è€Œå°†ç§¯åˆ†çš„è¿‡ç¨‹é™ä¸ºç‚¹ä¹˜ï¼š<br>$$<br>L_o\approx \rho \sum l_i T_i<br>$$</p>
<p>â€‹		å¯¹äºlambertæè´¨ï¼Œè§†çº¿æ— å…³ï¼Œbrdfå¯ä»¥æå–ä¸ºå¸¸æ•°é¡¹ï¼Œç”¨$\rho$è¡¨ç¤ºã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-04 17.05.58.png"  style="zoom:67%;" /></center>

<h3 id="3-2-Specular"><a href="#3-2-Specular" class="headerlink" title="3.2 Specular"></a>3.2 Specular</h3><p>â€‹		å¯¹äºglossyæè´¨ï¼Œbrdfä¸å†æ˜¯å¸¸æ•°ï¼Œè€Œæ˜¯2ä¸ªæ–¹å‘çš„4ç»´å‡½æ•°$\rho(\omega_i,\omega_o)$ï¼Œéœ€è¦è®¡ç®—è§†çº¿å’Œå…‰çº¿çš„ç»„åˆã€‚å‰æ–‡å·²å°†ä¼ è¾“å‡½æ•°æŠ•å½±åˆ°å…¥å°„æ–¹å‘ï¼š</p>
<p>$$<br>L(o)\approx \sum L_iT_i(o)<br>$$</p>
<p>â€‹		å°†æŠ•å½±åçš„ç»“æœï¼Œ<strong>å†ä¸€æ¬¡</strong>æŠ•å½±åˆ°å‡ºå°„æ–¹å‘ä¸Šï¼š<br>$$<br>T_i(o)\approx \sum t_{ij}B_j(o)<br>$$<br>â€‹		ä»£å…¥å…¬å¼16ï¼Œæœ€ç»ˆæœ‰ï¼š<br>$$<br>L(o)\approx \sum  (\sum l_it_{ij})B_j(o)<br>$$<br>â€‹		å³ä»¥å…‰ç…§ç³»æ•°ä¹˜ä¼ è¾“ç³»æ•°çŸ©é˜µï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-04 17.06.38.png"  style="zoom: 67%;" /></center>

<p>â€‹		ä»¥ä¸Šæ¶‰åŠåˆ°çŸ©é˜µè¿ç®—ã€å…¶è¿ç®—å¤æ‚åº¦å¢åŠ ï¼›å¯¹äºç‰¹åˆ«glossyçš„ç‰©ä½“ï¼Œä½é˜¶çƒè°çš„åº”ç”¨æ€§æœ‰é™ã€‚</p>
<p>â€‹		ä½é˜¶çƒè°ï¼Œç›¸æ¯”äºé¢„æ»¤æ³¢è¾ç…§åº¦è´´å›¾ï¼Œå…·æœ‰è¾ƒå¥½åœ°è¿˜åŸä½é¢‘ï¼ˆæ¼«åå°„ï¼‰ç¯å¢ƒå…‰å’Œï¼ˆè½¯ï¼‰é˜´å½±ã€çœå†…å­˜ã€è¿ç®—æ•ˆç‡é«˜çš„ä¼˜ç‚¹ï¼›ä½†æ˜¯å› ä¸ºæ¯•ç«Ÿåªèƒ½è¿˜åŸä½é¢‘ä¿¡æ¯ï¼Œå¦‚éœ€è¡¨ç°é•œé¢åå°„ï¼Œéœ€è¦ç»“åˆå…¶ä»–æ‰‹æ®µï¼Œæ¯”å¦‚é•œé¢è´´å›¾ã€‚</p>
<center><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-03 00.12.45.png" style="zoom:35%;" /><div><img src="/2023/02/05/Games202-2/assets/Games202-2.assets/2023-02-03 00.12.57.png"  style="zoom:54%;" /></div><p  style="color:#A9A9A9;">ç²¾é€‰å¼¹å¹•</p>  </center>



<p>ğŸ¦„ï¸ï¼š</p>
<blockquote>
<p>è¯¾ä»¶ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://sites.cs.ucsb.edu/~lingqi/teaching/resources/GAMES202_Lecture_05.pdf">https://sites.cs.ucsb.edu/~lingqi/teaching/resources/GAMES202_Lecture_05.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://sites.cs.ucsb.edu/~lingqi/teaching/resources/GAMES202_Lecture_06.pdf">https://sites.cs.ucsb.edu/~lingqi/teaching/resources/GAMES202_Lecture_06.pdf</a></p>
<p>PRTé˜…è¯»ææ–™ï¼š</p>
<p><strong><a target="_blank" rel="noopener" href="https://www.cse.chalmers.se/~uffe/xjobb/Readings/GlobalIllumination/Spherical%20Harmonic%20Lighting%20-%20the%20gritty%20details.pdf">https://www.cse.chalmers.se/~uffe/xjobb/Readings/GlobalIllumination/Spherical%20Harmonic%20Lighting%20-%20the%20gritty%20details.pdf</a></strong></p>
<p><a target="_blank" rel="noopener" href="https://cseweb.ucsd.edu/~ravir/prtsurvey.pdf">https://cseweb.ucsd.edu/~ravir/prtsurvey.pdf</a></p>
<p>IBL:</p>
<p><a target="_blank" rel="noopener" href="https://learnopengl-cn.github.io/07%20PBR/03%20IBL/02%20Specular%20IBL/">https://learnopengl-cn.github.io/07%20PBR/03%20IBL/02%20Specular%20IBL/</a></p>
<p>ç¬¬ä¸€éƒ¨åˆ†çš„æ•°å­¦ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/146144853">https://zhuanlan.zhihu.com/p/146144853</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/365624460">https://zhuanlan.zhihu.com/p/365624460</a></p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2023-02-04T16:00:00.000Z" title="2/5/2023, 12:00:00â€¯AM">2023-02-05</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2023-02-05T13:00:13.446Z" title="2/5/2023, 9:00:13â€¯PM">2023-02-05</time></span><span class="level-item">16 minutes lesen (Ãœber 2388 WÃ¶rter)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/05/Games202-2_hmw/">Games202 ä½œä¸š2</a></h1><div class="content"><h2 id="0"><a href="#0" class="headerlink" title="0."></a>0.</h2><p>$$<br>L(\omega_o) &#x3D; \int_{\Omega}L(\omega_i)V(\omega_i)\rho(\omega_i,\omega_o) max(0, nÂ·\omega_i)d\omega_i<br>$$</p>
<ul>
<li><p>$L(\omega_i)$ï¼šå…‰ç…§å‡½æ•°ï¼Œè¿™é‡Œæ˜¯é‡‡æ ·å¤©ç©ºç›’ï¼›</p>
</li>
<li><p>$T(x)&#x3D;\frac{c}{\pi}V(x,\omega_i)max(0, nÂ·\omega_i)$ï¼šä¼ è¾“é¡¹å‡½æ•°ï¼Œ$V(x,w_i)$ ï¼šå³visibilityï¼ŒæŒ‡é¡¶ç‚¹çš„å¯è§æ€§ï¼›$\rho(w_i,w_o) $ï¼šæ˜¯BRDFé¡¹ï¼Œå› ä¸ºåªè€ƒè™‘æ¼«åå°„ï¼Œæ‰€ä»¥å¯ä»¥æå–ä¸ºå¸¸æ•°é¡¹$\frac{c}{\pi}$;</p>
</li>
</ul>
<p>â€‹		éœ€è¦åšçš„æ˜¯å°†$L(\omega_i)$ã€$T(x)$è¿™ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«<strong>æŠ•å½±</strong>åˆ°çƒè°å‡½æ•°ä¸Šï¼Œå³æ±‚å‡ºå…¶å¯¹åº”ç³»æ•°å¹¶å­˜å‚¨åˆ°çŸ©é˜µé‡Œï¼Œåœ¨æ¸²æŸ“æ—¶ä½¿ç”¨ï¼Œä»è€ŒåŒ–ç§¯åˆ†ä¸ºç‚¹ä¹˜:<br>$$<br>L&#x3D; \sum_{i&#x3D;0}^{n} L_i T_i<br>$$</p>
<p>â€‹		ä½œä¸šä¸­ä½¿ç”¨çš„2ä¸ªçŸ©é˜µä¸ºï¼š</p>
<ul>
<li><p>m_LightCoeffs ï¼šè®°å½•ç¯å¢ƒå…‰çš„çƒè°ç³»æ•°ï¼Œä»¥rgbçš„å½¢å¼å­˜å‚¨ï¼Œæ˜¯å¤§å° 3 x (l + 1) ^ 2çš„çŸ©é˜µï¼Œæ¯åˆ—å­˜å‚¨æ¯ä¸ªç¯å¢ƒå…‰ç³»æ•°çš„rgbå€¼ï¼›</p>
</li>
<li><p>m_TransportSHCoeffsï¼š è®°å½•ä¼ è¾“é¡¹ç³»æ•°ï¼Œæ˜¯å¤§å°(l + 1) ^ 2 x é¡¶ç‚¹æ•°é‡çš„çŸ©é˜µï¼Œ(i ,  j) å­˜å‚¨ç¬¬jä¸ªé¡¶ç‚¹çš„ç¬¬iä¸ªç³»æ•°ã€‚</p>
</li>
</ul>
<h2 id="1-Project"><a href="#1-Project" class="headerlink" title="1. Project :"></a>1. Project :</h2><h3 id="1-1-è®¡ç®—ç¯å¢ƒå…‰ç³»æ•°"><a href="#1-1-è®¡ç®—ç¯å¢ƒå…‰ç³»æ•°" class="headerlink" title="1.1 è®¡ç®—ç¯å¢ƒå…‰ç³»æ•°"></a>1.1 è®¡ç®—ç¯å¢ƒå…‰ç³»æ•°</h3><p>â€‹		å‰æ–‡å·²çŸ¥ï¼ŒæŠ•å½±çš„è¿‡ç¨‹ã€å³æ±‚è¢«æŠ•å‡½æ•°*åŸºå‡½æ•°åœ¨åŸå‡½æ•°å®šä¹‰åŸŸä¸Šç§¯åˆ†çš„è¿‡ç¨‹ã€‚å¯¹äºä¸€ä¸ªå®šä¹‰åœ¨çƒåæ ‡ç³»ä¸Šçš„å‡½æ•°$f(\theta,\phi)$ï¼Œå…¶ç§¯åˆ†ä¸ºï¼š$\int_0^{2\pi}\int_0^{\pi}f(\theta,\phi)sin(\theta)d\theta d\phi$ï¼Œå…¶ä¸­$sin(\theta)$ç”¨äºå¹³è¡¡ä¸¤æåˆ°èµ¤é“çš„ä¸åŒå•ä½ç«‹ä½“è§’å¤§å°ã€‚ä½†æ˜¯å› ä¸ºè’™ç‰¹å¡æ´›ç§¯åˆ†çš„æ ·æœ¬æœ¬èº«æ˜¯æ— åçš„ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬æœ‰ç›¸ç­‰çš„æ¦‚ç‡å¯†åº¦å‡½æ•°$\frac{1}{4\pi}$ï¼Œå› æ­¤åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨$4\pi$ä»£æ›¿$sin(\theta)$ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰ç¬¬iä¸ªç³»æ•°çš„ç¦»æ•£å…¬å¼ä¸ºï¼š<br>$$<br>C_i&#x3D;\frac{4\pi}{N}\sum_{i&#x3D;1}^{N}L(x_j)Y_i(x_j)<br>$$<br>â€‹		ç¬¬ä¸€æ­¥éœ€è¦åœ¨PrecomputeCubemapSHå‡½æ•°å®Œæˆå¯¹ç¯å¢ƒå…‰ç³»æ•°çš„æ±‚è§£ï¼Œå¹¶å°†è¿”å›å€¼ä»¥RGBçš„å­˜å‚¨åœ¨çŸ©é˜µm_LightCoeffsé‡Œã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> envCoeffs = ProjEnv::<span class="built_in">PrecomputeCubemapSH</span>&lt;SHOrder&gt;(images, width, height, channel);</span><br></pre></td></tr></table></figure>

<p>â€‹		EvalSH å‡½æ•°å³ $Y_l^m(\theta, \varphi)$ , è®¡ç®—æ¯ä¸ªå•ä½æ–¹å‘å‘é‡å¯¹åº”çš„åŸºå‡½æ•°<strong>å€¼</strong>ï¼š</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">EvalSH</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> m, <span class="type">const</span> Eigen::Vector3d&amp; dir)</span> </span></span><br></pre></td></tr></table></figure>

<p>â€‹		ç¬¬lé˜¶ã€ç¬¬mä¸ªç³»æ•°çš„å¯¹åº”æ•°ç»„åºå·å¯å‚è€ƒæºç é‡Œçš„GetIndexå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">GetIndex</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> l * (l + <span class="number">1</span>) + m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½œä¸šæ¡†æ¶ä¸­ä½¿ç”¨çš„æ˜¯é»æ›¼å’Œæ–¹æ³•å¯¹ç¯å¢ƒå…‰æ±‚ç§¯åˆ†ï¼Œæƒé‡ä¸ºç«‹æ–¹ä½“è´´å›¾çš„å•ä¸ªçº¹ç´ æ‰€å¯¹åº”åœ¨çƒä½“ä¸Šçš„è¡¨é¢ç§¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">float</span> <span class="title">CalcArea</span><span class="params">(<span class="type">const</span> <span class="type">float</span> &amp;u_, <span class="type">const</span> <span class="type">float</span> &amp;v_, <span class="type">const</span> <span class="type">int</span> &amp;width, <span class="type">const</span> <span class="type">int</span> &amp;height)</span></span></span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">0</span>; l &lt; SHOrder; l++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> m = -l; m &lt;= l; m++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">float</span> sh = sh::<span class="built_in">EvalSH</span>(l, m, dir.<span class="built_in">cast</span>&lt;<span class="type">double</span>&gt;().<span class="built_in">normalized</span>());</span><br><span class="line">		<span class="type">float</span> delta = <span class="built_in">CalcArea</span>(x, y, width, height);</span><br><span class="line">		SHCoeffiecents[l * (l + <span class="number">1</span>) + m] += Le * sh * delta; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-è®¡ç®—ä¼ è¾“é¡¹ç³»æ•°"><a href="#1-2-è®¡ç®—ä¼ è¾“é¡¹ç³»æ•°" class="headerlink" title="1.2 è®¡ç®—ä¼ è¾“é¡¹ç³»æ•°"></a>1.2 è®¡ç®—ä¼ è¾“é¡¹ç³»æ•°</h3><p>â€‹		æ¯ä¸ªé¡¶ç‚¹çš„ä¼ è¾“é¡¹ç³»æ•°ï¼Œå®é™…è®°å½•ç€å…¶å¯ä»¥æ¥æ”¶åˆ°<strong>å¤šå°‘</strong>ç›´æ¥å’Œé—´æ¥å…‰ç…§ã€‚		</p>
<p>â€‹		shFunc æ˜¯ä¼ è¾“é¡¹å‡½æ•°ï¼Œæ˜¯éœ€è¦<strong>è¢«æŠ•å½±</strong>åˆ°çƒè°å‡½æ•°ä¸Šçš„æ–¹ç¨‹ï¼Œä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬å®Œæˆçš„éƒ¨åˆ†ï¼Œç”±ç®€åˆ°ç¹ä¾æ¬¡æœ‰unshadowedã€shadowedå’Œinterreflectionä¸‰ç§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> shCoeff = sh::<span class="built_in">ProjectFunction</span>(SHOrder, shFunc, m_SampleCount);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; shCoeff-&gt;<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">  	m_TransportSHCoeffs.<span class="built_in">col</span>(i).<span class="built_in">coeffRef</span>(j) = (*shCoeff)[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		æŠ•å½±å‡½æ•°sh::ProjectFunctionï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fit the given analytical spherical function to the SH basis functions</span></span><br><span class="line"><span class="comment">// up to @order. This uses Monte Carlo sampling to estimate the underlying</span></span><br><span class="line"><span class="comment">// integral.</span></span><br><span class="line">std::unique_ptr&lt;std::vector&lt;<span class="type">double</span>&gt;&gt; <span class="built_in">ProjectFunction</span>(</span><br><span class="line">    <span class="type">int</span> order, <span class="type">const</span> SphericalFunction&amp; func, <span class="type">int</span> sample_count);</span><br></pre></td></tr></table></figure>

<p>â€‹		å¯¹äºå‰ä¸¤ç§æƒ…å†µï¼Œç¿»è¯‘å…¬å¼å¡«åˆ°shFuncé‡Œå°±è¡Œï¼›å› ä¸ºåªè€ƒè™‘æ¼«åå°„è¡¨é¢ï¼Œbrdfé¡¹å¯ä»¥ç®€åŒ–ä¸ºå¸¸é‡ï¼Œå› æ­¤ä¼ è¾“é¡¹ä¸ºï¼š<br>$$<br>L_{DS}(x)&#x3D;\frac{\rho_x}{\pi} \int_{\Omega}V(w_i) max(0, n_xÂ·w_i)dw_i<br>$$<br>â€‹		å› ä¸ºsh::ProjectFunctionä¸­åªæœ‰ç§¯åˆ†çš„å³åŠéƒ¨åˆ†ï¼Œæ‰€ä»¥æœ€ç»ˆç³»æ•°éœ€è¦è‡ªè¡Œé™¤ä»¥$\pi$ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (m_Type == Type::Unshadowed)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> here you need to calculate unshadowed transport term of a given direction</span></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> æ­¤å¤„ä½ éœ€è¦è®¡ç®—ç»™å®šæ–¹å‘ä¸‹çš„unshadowedä¼ è¾“é¡¹çƒè°å‡½æ•°å€¼</span></span><br><span class="line">	<span class="keyword">return</span> std::<span class="built_in">max</span>(<span class="built_in">float</span>(<span class="number">0.</span>), wi.<span class="built_in">dot</span>(n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> here you need to calculate shadowed transport term of a given direction</span></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> æ­¤å¤„ä½ éœ€è¦è®¡ç®—ç»™å®šæ–¹å‘ä¸‹çš„shadowedä¼ è¾“é¡¹çƒè°å‡½æ•°å€¼</span></span><br><span class="line">	<span class="type">double</span> H = wi.<span class="built_in">dot</span>(n);</span><br><span class="line">	<span class="keyword">return</span> (H &gt; <span class="number">0</span> &amp;&amp; !(scene-&gt;<span class="built_in">rayIntersect</span>(<span class="built_in">Ray3f</span>(v, wi.<span class="built_in">normalized</span>()))))? H : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹		è€Œè€ƒè™‘åˆ°å…‰çº¿å®é™…ä¼šåœ¨è¡¨é¢é—´äº’ç›¸å¼¹å°„ï¼ˆinterrelectionï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–ç€è‰²ç‚¹ä¼šæˆä¸º<strong>æ¬¡çº§å…‰æº</strong>ç…§äº®å½“å‰ç‚¹ï¼Œå› æ­¤<strong>ä¸€æ¬¡å¼¹å°„</strong>çš„å…¬å¼ï¼š<br>$$<br>L_{DI}(x)&#x3D;L_{DS}+\frac{\rho_x}{\pi} \int_{\Omega}\overline{L}(xâ€™,w_i)(1-V(w_i)) max(0, n_xÂ·w_i)dw_i<br>$$<br>â€‹		åœ¨è®¡ç®—å‡ºå½“å‰é¡¶ç‚¹çš„Diffuse Shadowå€¼ä¹‹åï¼Œç”¨è’™ç‰¹å¡æ´›ç§¯åˆ†æ³•è¿›è¡Œé‡‡æ ·ï¼›å¯¹äºæ¯ä¸€ä¸ªæ ·æœ¬ï¼ˆå°„çº¿ï¼‰ï¼Œå¦‚æœä¸åœºæ™¯ä¸­çš„ç‰©ä½“æœ‰äº¤ç‚¹ï¼Œåˆ™å°†äº¤ç‚¹å¤„çš„ç³»æ•°å€¼è§†ä½œæ¬¡çº§å…‰æºï¼Œå¹¶è®¡ç®—å…¶<strong>å¯¹åŸé¡¶ç‚¹</strong>çš„è´¡çŒ®ã€‚è€Œè®¡ç®—äº¤ç‚¹å¤„çš„å€¼ï¼Œåˆ™éœ€è¦ç”¨ä¸‰è§’å½¢é‡å¿ƒçº¿æ€§æ’å€¼ä¸‰ä¸ªé¡¶ç‚¹çš„ç³»æ•°å³å¯ï¼Œè¿™ä¹Ÿæ˜¯å…¬å¼ä¸­$\overline{L}(xâ€™)$çš„æ„ä¹‰ã€‚</p>
<p>â€‹		éå†å®Œæ‰€æœ‰é¡¶ç‚¹æ‰€å¾—çš„ä¸€ç»„<strong>æ–°çš„</strong>ç³»æ•°ï¼ˆå…¬å¼çš„å³åŠéƒ¨åˆ†ï¼‰ï¼Œæ­£æ˜¯ä¸‹ä¸€æ¬¡å¼¹å°„çš„åˆå§‹ç³»æ•°ï¼ˆå…¬å¼çš„å·¦åŠéƒ¨åˆ†ï¼‰ã€‚é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´åˆ°å…‰ç…§æ”¶æ•›æˆ–åˆ°è¾¾è¿­ä»£æ¬¡æ•°ã€‚æœ€åå°†æ‰€æœ‰å¼¹å°„æ‰€å¾—ç³»æ•°ç´¯åŠ è‡³åŸä¼ è¾“é¡¹ç³»æ•°ä¸Šã€‚</p>
<blockquote>
<p>Global illumination and radiosity programmers will recognize this is a probabilistic gathering solution, where each point on the model blindly searches for neighbors that can see it and drags in light from the outside world, with the effect that the model is slowly lit by completely solving one lighting point at a time. </p>
</blockquote>
<p>â€‹		å› ä¸ºå½¢å¼ä¸Šçš„ç›¸è¿‘ï¼Œå¯ä»¥é­”æ”¹sh::ProjectFunctionå‡½æ•°ã€‚æ³¨æ„9ä¸ªç³»æ•°åˆ†åˆ«å¯¹åº”ä¸åŒçš„å€¼ã€‚ å¦‚æœè€ƒè™‘ç‰©ä½“æœ¬èº«çš„é¢œè‰²æˆ–åœºæ™¯ä¸­å®é™…æœ‰å¤šä¸ªç‰©ä½“ï¼ŒLé¡¹ç³»æ•°ä¹Ÿéœ€è¦è®¡ç®—ï¼Œè¿™é‡Œåªè®¡ç®—äº†Té¡¹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (m_Type == Type::Interreflection)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">std::vector&lt;Eigen::MatrixXf&gt; <span class="title">transportSHCoeffs</span><span class="params">(m_Bounce, Eigen::MatrixXf(SHCoeffLength, mesh-&gt;getVertexCount()))</span></span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> bounce = <span class="number">0</span>; bounce &lt; m_Bounce; bounce++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; mesh-&gt;<span class="built_in">getVertexCount</span>(); i++)</span><br><span class="line">				&#123;</span><br><span class="line">					Point3f v = mesh-&gt;<span class="built_in">getVertexPositions</span>().<span class="built_in">col</span>(i);</span><br><span class="line">					<span class="type">const</span> Normal3f &amp;n = mesh-&gt;<span class="built_in">getVertexNormals</span>().<span class="built_in">col</span>(i);</span><br><span class="line">					<span class="keyword">auto</span> shFunc = [&amp;](<span class="type">double</span> phi, <span class="type">double</span> theta) -&gt; std::vector&lt;<span class="type">double</span>&gt;</span><br><span class="line">					&#123;</span><br><span class="line">						Eigen::Array3d d = sh::<span class="built_in">ToVector</span>(phi, theta);</span><br><span class="line">						<span class="keyword">auto</span> wi = <span class="built_in">Vector3f</span>(d.<span class="built_in">x</span>(), d.<span class="built_in">y</span>(), d.<span class="built_in">z</span>()).<span class="built_in">normalized</span>();</span><br><span class="line">						Intersection its;</span><br><span class="line">						<span class="function">std::vector&lt;<span class="type">double</span>&gt; <span class="title">res</span><span class="params">(SHCoeffLength, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">						<span class="keyword">auto</span> H = wi.<span class="built_in">dot</span>(n);</span><br><span class="line">						<span class="keyword">if</span> (H &gt; <span class="number">0</span> &amp;&amp; scene-&gt;<span class="built_in">rayIntersect</span>(<span class="built_in">Ray3f</span>(v, wi), its))</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="type">const</span> Vector3f &amp;bary = its.bary;</span><br><span class="line">							<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; SHCoeffLength; j++)</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="keyword">auto</span> its_x = its.tri_index.<span class="built_in">x</span>();</span><br><span class="line">								<span class="keyword">auto</span> its_y = its.tri_index.<span class="built_in">y</span>();</span><br><span class="line">								<span class="keyword">auto</span> its_z = its.tri_index.<span class="built_in">z</span>();</span><br><span class="line">								Vector3f sh = (bounce &gt; <span class="number">0</span>) ? <span class="built_in">Vector3f</span>(transportSHCoeffs[bounce - <span class="number">1</span>].<span class="built_in">col</span>(its_x).<span class="built_in">coeffRef</span>(j), transportSHCoeffs[bounce - <span class="number">1</span>].<span class="built_in">col</span>(its_y).<span class="built_in">coeffRef</span>(j), transportSHCoeffs[bounce - <span class="number">1</span>].<span class="built_in">col</span>(its_z).<span class="built_in">coeffRef</span>(j))</span><br><span class="line">														   : <span class="built_in">Vector3f</span>(m_TransportSHCoeffs.<span class="built_in">col</span>(its_x).<span class="built_in">coeffRef</span>(j), m_TransportSHCoeffs.<span class="built_in">col</span>(its_y).<span class="built_in">coeffRef</span>(j), m_TransportSHCoeffs.<span class="built_in">col</span>(its_z).<span class="built_in">coeffRef</span>(j));</span><br><span class="line"></span><br><span class="line">								<span class="keyword">auto</span> indirectSH = bary.<span class="built_in">dot</span>(sh);</span><br><span class="line">								res[j] = indirectSH * H;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">						<span class="keyword">return</span> res;</span><br><span class="line">					&#125;;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">auto</span> shCoeff = sh::<span class="built_in">ProjectFunctionCustom</span>(SHOrder, shFunc, m_SampleCount);</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; shCoeff-&gt;<span class="built_in">size</span>(); j++)</span><br><span class="line">					&#123;</span><br><span class="line">						transportSHCoeffs[bounce].<span class="built_in">col</span>(i).<span class="built_in">coeffRef</span>(j) = (*shCoeff)[j] / M_PI;</span><br><span class="line">						<span class="comment">// ç´¯åŠ </span></span><br><span class="line">						m_TransportSHCoeffs.<span class="built_in">col</span>(i).<span class="built_in">coeffRef</span>(j) += transportSHCoeffs[bounce].<span class="built_in">col</span>(i).<span class="built_in">coeffRef</span>(j);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The assumption here is that illumination doesnâ€™t vary across the model (i.e. point B has exactly the same lighting function as point A). This is the key to SH lighting: Low frequency light sources and very small light source variance across an object. </p>
</blockquote>
<center ><img src="/2023/02/05/Games202-2_hmw/assets/Games202-2_hmw.assets/shadowed.png"  style="zoom:50%;" /> <img src="/2023/02/05/Games202-2_hmw/assets/Games202-2_hmw.assets/inter5.png" style="zoom:50%;" /><p style="color:#A9A9A9;">
  å·¦shadowedï¼Œå³interreflection = 5
  </p></center>

<p>â€‹		ä¼¼ä¹è·Ÿä½œä¸šæ–‡æ¡£æœ‰åˆ†æ­§<del>ï¼ˆç®—äº†æ”¶æ•›äº†å°±è¡Œï¼‰</del></p>
<h2 id="2-Reconstruct"><a href="#2-Reconstruct" class="headerlink" title="2. Reconstruct"></a>2. Reconstruct</h2><p>â€‹		ç›´æ¥ç¿»è¯‘å…¬å¼3ï¼Œåœ¨vertex shaderé‡Œè®¡ç®—æ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²ï¼Œç»æ’å€¼åä¼ é€’ç»™fragment shaderå³å¯ã€‚</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">attribute</span> <span class="type">mat3</span> aPrecomputeLT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat3</span> uPrecomputeLR;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat3</span> uPrecomputeLG;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat3</span> uPrecomputeLB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">varying</span> <span class="type">vec3</span> vColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main(<span class="type">void</span>) &#123;</span><br><span class="line">    vColor = <span class="type">vec3</span>(<span class="number">0.0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)&#123;</span><br><span class="line">            vColor += aPrecomputeLT[i][j] * <span class="type">vec3</span>(uPrecomputeLR[i][j], uPrecomputeLG[i][j], uPrecomputeLB[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">gl_Position</span> = uProjectionMatrix * uViewMatrix * uModelMatrix * <span class="type">vec4</span>(aVertexPosition, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<center ><img src="/2023/02/05/Games202-2_hmw/assets/Games202-2_hmw.assets/prt-sh.png"  style="zoom:50%;" /><img src="/2023/02/05/Games202-2_hmw/assets/Games202-2_hmw.assets/prt-in.png" style="zoom:53.5%;" /><p style="color:#A9A9A9;">
  å·¦shadowedï¼›å³interreflectionï¼Œå…¶self-shadowç¨äº®
  </p></center>


<h2 id="3-æ—‹è½¬"><a href="#3-æ—‹è½¬" class="headerlink" title="3. æ—‹è½¬"></a>3. æ—‹è½¬</h2><p>â€‹		prtä¸­è™½ç„¶è¦æ±‚åœºæ™¯æ˜¯é™æ€çš„ï¼Œä½†ç”±äºçƒè°å‡½æ•°å…·æœ‰æ—‹è½¬ä¸å˜æ€§ï¼Œæ‰€ä»¥å…‰æºå¯ä»¥æ—‹è½¬ã€‚æ ¹æ®æ–‡æ¡£ç»™å‡ºçš„å…¬å¼ç¿»è¯‘æˆä»£ç ï¼Œå¡«åˆ°tools.jsæ–‡ä»¶ä¸­å¯¹åº”çš„åœ°æ–¹ã€‚</p>
<p>â€‹		**glslçš„çŸ©é˜µæ˜¯åˆ—ä¸»åºï¼Œmat[i][j]è¡¨ç¤ºç¬¬iåˆ—ã€ç¬¬jè¡Œçš„å€¼ï¼Œä½†æ˜¯math.size(i, j)ã€jsæ•°ç»„éƒ½æ˜¯è¡Œä¸»åºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getRotationPrecomputeL</span>(<span class="params">precompute_L, rotationMatrix</span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> mat3 = <span class="title function_">computeSquareMatrix_3by3</span>(rotationMatrix);</span><br><span class="line">	<span class="keyword">let</span> mat5 = <span class="title function_">computeSquareMatrix_5by5</span>(rotationMatrix);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> result = [];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">let</span> res = math.<span class="title function_">multiply</span>(mat3, [precompute_L[i][<span class="number">1</span>], precompute_L[i][<span class="number">2</span>], precompute_L[i][<span class="number">3</span>]]).<span class="property">_data</span>;</span><br><span class="line">		<span class="keyword">let</span> res5 = math.<span class="title function_">multiply</span>(mat5, [precompute_L[i][<span class="number">4</span>], precompute_L[i][<span class="number">5</span>], precompute_L[i][<span class="number">6</span>], precompute_L[i][<span class="number">6</span>], precompute_L[i][<span class="number">8</span>]]).<span class="property">_data</span>;</span><br><span class="line">		result.<span class="title function_">push</span>([precompute_L[i][<span class="number">0</span>], res[<span class="number">0</span>], res[<span class="number">1</span>], res[<span class="number">2</span>], res5[<span class="number">0</span>], res5[<span class="number">1</span>], res5[<span class="number">2</span>], res5[<span class="number">3</span>], res5[<span class="number">4</span>]]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">computeSquareMatrix_3by3</span>(<span class="params">rotationMatrix</span>) &#123; <span class="comment">// è®¡ç®—æ–¹é˜µSA(-1) 3*3 </span></span><br><span class="line">	<span class="comment">// 1ã€pick ni - &#123;ni&#125;</span></span><br><span class="line">	<span class="comment">// å¯¹äºç¬¬ l å±‚ bandï¼Œé€‰å– 2l + 1 ä¸ª normal vector n</span></span><br><span class="line">	<span class="keyword">let</span> n1 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]; <span class="keyword">let</span> n2 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]; <span class="keyword">let</span> n3 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>];</span><br><span class="line">	<span class="keyword">let</span> normals = [n1, n2, n3];</span><br><span class="line">	<span class="keyword">let</span> A = math.<span class="title function_">zeros</span>(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">	<span class="keyword">let</span> S = math.<span class="title function_">zeros</span>(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">	<span class="keyword">let</span> A_inverse = math.<span class="title function_">zeros</span>(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">	<span class="comment">//	let rotationMatrix_trans = math.transpose(mat4Matrix2mathMatrix(rotationMatrix)); // æ•°åˆ—è½¬æ¢ä¸ºmath.mat</span></span><br><span class="line">	<span class="keyword">let</span> rotationMatrix_trans = (<span class="title function_">mat4Matrix2mathMatrix</span>(rotationMatrix)); <span class="comment">// æ•°åˆ—è½¬æ¢ä¸ºmath.mat</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2ã€&#123;P(ni)&#125; - A  A_inverse</span></span><br><span class="line">	<span class="comment">// è®¡ç®—(2l + 1)ä¸ªnå„è‡ªåœ¨çƒè°ä¸Šçš„æŠ•å½±ï¼Œæ¯ä¸ªæœ‰(2l + 1)ä¸ªç³»æ•°ï¼Œæ„æˆ(2l + 1) * (2l + 1)çš„çŸ©é˜µAï¼Œå¹¶æ±‚å…¶é€†çŸ©é˜µ</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">let</span> proj = <span class="title class_">SHEval3</span>(normals[i][<span class="number">0</span>], normals[i][<span class="number">1</span>], normals[i][<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			A.<span class="title function_">set</span>([j - <span class="number">1</span>, i], proj[j]);<span class="comment">// iè¡Œjåˆ—</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	A_inverse = math.<span class="title function_">inv</span>(A);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3ã€ç”¨ R æ—‹è½¬ ni - &#123;R(ni)&#125;</span></span><br><span class="line">	<span class="comment">// 4ã€R(ni) SHæŠ•å½± - S</span></span><br><span class="line">	<span class="comment">// ç”¨è¾“å…¥çš„æ—‹è½¬çŸ©é˜µæ—‹è½¬niï¼Œå¹¶å°†ç»“æœæŠ•å½±ï¼Œç±»ä¼¼æ­¥éª¤2ï¼Œå¾—åˆ°(2l + 1) * (2l + 1)çš„çŸ©é˜µS</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">		<span class="comment">//let vec = math.matrix([normals[i][0], normals[i][1], normals[i][2], 0]); // col vector  </span></span><br><span class="line">		<span class="comment">//let n = math.multiply(rotationMatrix_trans, vec)._data;// (4 * 4) * (4 * 1) ç¬¬ä¸€ä¸ªåˆ—æ•°ç­‰äºç¬¬äºŒä¸ªè¡Œæ•°</span></span><br><span class="line">		<span class="keyword">let</span> n = vec4.<span class="title function_">create</span>();</span><br><span class="line">		vec4.<span class="title function_">transformMat4</span>(n, normals[i], rotationMatrix);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">let</span> proj = <span class="title class_">SHEval3</span>(n[<span class="number">0</span>], n[<span class="number">1</span>], n[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			S.<span class="title function_">set</span>([j - <span class="number">1</span>, i], proj[j]);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5ã€S*A_inverse</span></span><br><span class="line">	<span class="keyword">return</span> math.<span class="title function_">multiply</span>(S, A_inverse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center><img src="/2023/02/05/Games202-2_hmw/assets/Games202-2_hmw.assets/127.0.0.1_5501 (1).gif"  style="zoom:80%;" /></center>





<p>ğŸ”§å·¥å…·ï¼š</p>
<p><strong>Glsl:</strong>  <a target="_blank" rel="noopener" href="https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.30.pdf#page=35">https://registry.khronos.org/OpenGL/specs/gl/GLSLangSpec.4.30.pdf#page=35</a></p>
<p><strong>Webgl:</strong>  <a target="_blank" rel="noopener" href="https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html">https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html</a></p>
<p>ide debug:  <a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/cpp/launch-json-reference">https://code.visualstudio.com/docs/cpp/launch-json-reference</a></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.png" alt="shugen"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">shugen</p><p class="is-size-6 is-block">zzz</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShangHai</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Seiten</p><a href="/archives"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tag</p><a href="/tags"><p class="title">1</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/olirrrt"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://trilozzz.lofter.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Trilo67899622"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Letzte EintrÃ¤ge</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-04T16:00:00.000Z">2023-02-05</time></p><p class="title"><a href="/2023/02/05/Games202-2/">Games202-2 å®æ—¶ç¯å¢ƒå…‰ç…§</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-04T16:00:00.000Z">2023-02-05</time></p><p class="title"><a href="/2023/02/05/Games202-2_hmw/">Games202 ä½œä¸š2</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-03T16:00:00.000Z">2023-02-04</time></p><p class="title"><a href="/2023/02/04/test/">äººç”Ÿè´µåœ¨æŠ˜è…¾(â‰§â–½â‰¦)</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archive</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">February 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"><span class="tag">å›¾å½¢å­¦</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Abonnieren Sie Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Abonnieren"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Abonnieren"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">.</a><p class="is-size-7"><span>&copy; 2023 shugen</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en-us");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="ZurÃ¼ck nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "Diese Website verwendet Cookies, um Ihre Erfahrung zu verbessern.",
          dismiss: "Verstanden!",
          allow: "Cookies zulassen",
          deny: "Ablehnen",
          link: "Mehr erfahren",
          policy: "Cookie-Richtlinie",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Tippen Sie etwas..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Tippen Sie etwas...","untitled":"(Ohne Titel)","posts":"Seiten","pages":"Pages","categories":"Kategorien","tags":"Tags"});
        });</script></body></html>